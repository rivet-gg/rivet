# yaml-language-server: $schema=https://raw.githubusercontent.com/fern-api/fern/main/fern.schema.json

imports:
  commons: ../../common.yml
  uploadCommons: ../../upload/common.yml
  cloudCommons: ../../cloud/common.yml

service:
  auth: true
  base-path: /games/{game_id}/builds
  path-parameters:
    game_id: uuid
  endpoints:
    listBuilds:
      path: ""
      method: GET
      docs: >-
        Lists all builds of the game associated with the token used. Can be
        filtered by tags in the query string.
      request:
        name: GetBuildsRequest
        query-parameters:
          tags: optional<string>
          game_id: optional<uuid>
      response: ListBuildsResponse

    prepareBuild:
      path: /prepare
      method: POST
      docs: Creates a new game build for the given game.
      request:
        body: CreateBuildRequest
      response: CreateBuildResponse

    completeBuild:
      path: /{build_id}/complete
      method: POST
      docs: Marks an upload as complete.
      path-parameters:
        build_id:
          type: uuid

types:
  ListBuildsResponse:
    properties:
      builds:
        docs: A list of builds for the game associated with the token.
        type: list<cloudCommons.BuildSummary>

  CreateBuildRequest:
    properties:
      display_name: commons.DisplayName
      tags: unknown
      image_tag:
        docs: A tag given to the game build.
        type: string
      image_file: uploadCommons.PrepareFile
      multipart_upload:
        type: optional<boolean>
      kind: optional<BuildKind>
      compression: optional<BuildCompression>

  CreateBuildResponse:
    properties:
      build_id:
        type: uuid
      upload_id:
        type: uuid
      image_presigned_request: optional<uploadCommons.PresignedRequest>
      image_presigned_requests: optional<list<uploadCommons.PresignedRequest>>

  BuildKind:
    enum:
      - value: docker_image
        docs: Docker image archive generated by `docker save`.
      - value: oci_bundle
        docs: OCI-compliant bundle.

  BuildCompression:
    enum:
      - value: none
        docs: None compression.
      - value: lz4
        docs: LZ4 compression. Use the minimum compression level.
