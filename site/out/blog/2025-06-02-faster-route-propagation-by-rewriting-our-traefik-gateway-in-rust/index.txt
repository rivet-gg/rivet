1:"$Sreact.fragment"
2:I[65327,["1965","static/chunks/f67032f2-9c72234b0d8f41b4.js","8229","static/chunks/9da6db1e-dbfab9261a7c6a02.js","7134","static/chunks/7134-7a2ccc87dc1f1c96.js","9078","static/chunks/9078-9c4b2ff48765f274.js","6855","static/chunks/6855-c97c866fb9680afe.js","3285","static/chunks/3285-d8e61078321bd50f.js","9657","static/chunks/9657-90d7d8e86cd8d7b3.js","1983","static/chunks/1983-7439545cf8f39348.js","7678","static/chunks/7678-80db3db210142fa5.js","3459","static/chunks/3459-aa0b1d8277b7bbbd.js","7177","static/chunks/app/layout-e3cfc449b871f8f6.js"],"GoogleAnalytics"]
3:I[559,["1965","static/chunks/f67032f2-9c72234b0d8f41b4.js","8229","static/chunks/9da6db1e-dbfab9261a7c6a02.js","7134","static/chunks/7134-7a2ccc87dc1f1c96.js","9078","static/chunks/9078-9c4b2ff48765f274.js","6855","static/chunks/6855-c97c866fb9680afe.js","3285","static/chunks/3285-d8e61078321bd50f.js","9657","static/chunks/9657-90d7d8e86cd8d7b3.js","1983","static/chunks/1983-7439545cf8f39348.js","7678","static/chunks/7678-80db3db210142fa5.js","3459","static/chunks/3459-aa0b1d8277b7bbbd.js","7177","static/chunks/app/layout-e3cfc449b871f8f6.js"],""]
4:I[32761,["1965","static/chunks/f67032f2-9c72234b0d8f41b4.js","7134","static/chunks/7134-7a2ccc87dc1f1c96.js","9078","static/chunks/9078-9c4b2ff48765f274.js","6855","static/chunks/6855-c97c866fb9680afe.js","5051","static/chunks/5051-51ff92d736937f41.js","9657","static/chunks/9657-90d7d8e86cd8d7b3.js","1983","static/chunks/1983-7439545cf8f39348.js","7678","static/chunks/7678-80db3db210142fa5.js","3545","static/chunks/3545-9e4a648ea2701538.js","35","static/chunks/app/(v2)/(blog)/blog/page-6e2380a8fbf5f3da.js"],"TooltipProvider"]
5:I[79838,["1965","static/chunks/f67032f2-9c72234b0d8f41b4.js","8229","static/chunks/9da6db1e-dbfab9261a7c6a02.js","7134","static/chunks/7134-7a2ccc87dc1f1c96.js","9078","static/chunks/9078-9c4b2ff48765f274.js","6855","static/chunks/6855-c97c866fb9680afe.js","3285","static/chunks/3285-d8e61078321bd50f.js","9657","static/chunks/9657-90d7d8e86cd8d7b3.js","1983","static/chunks/1983-7439545cf8f39348.js","7678","static/chunks/7678-80db3db210142fa5.js","3459","static/chunks/3459-aa0b1d8277b7bbbd.js","7177","static/chunks/app/layout-e3cfc449b871f8f6.js"],"Providers"]
6:I[49287,[],""]
7:I[34235,[],""]
8:I[91971,["1965","static/chunks/f67032f2-9c72234b0d8f41b4.js","7134","static/chunks/7134-7a2ccc87dc1f1c96.js","9078","static/chunks/9078-9c4b2ff48765f274.js","6855","static/chunks/6855-c97c866fb9680afe.js","5051","static/chunks/5051-51ff92d736937f41.js","9657","static/chunks/9657-90d7d8e86cd8d7b3.js","1983","static/chunks/1983-7439545cf8f39348.js","7678","static/chunks/7678-80db3db210142fa5.js","3545","static/chunks/3545-9e4a648ea2701538.js","35","static/chunks/app/(v2)/(blog)/blog/page-6e2380a8fbf5f3da.js"],"Toaster"]
9:I[82345,["7134","static/chunks/7134-7a2ccc87dc1f1c96.js","9078","static/chunks/9078-9c4b2ff48765f274.js","3591","static/chunks/3591-193e430a542376f5.js","4395","static/chunks/4395-09a8f40ef66f9d5c.js","9657","static/chunks/9657-90d7d8e86cd8d7b3.js","1983","static/chunks/1983-7439545cf8f39348.js","7261","static/chunks/7261-eddb3e7984c54a8d.js","5212","static/chunks/app/(v2)/(blog)/blog/layout-04840f1e5a481f10.js"],"Header"]
a:I[59534,["1965","static/chunks/f67032f2-9c72234b0d8f41b4.js","7134","static/chunks/7134-7a2ccc87dc1f1c96.js","9078","static/chunks/9078-9c4b2ff48765f274.js","6855","static/chunks/6855-c97c866fb9680afe.js","5051","static/chunks/5051-51ff92d736937f41.js","9657","static/chunks/9657-90d7d8e86cd8d7b3.js","1983","static/chunks/1983-7439545cf8f39348.js","7678","static/chunks/7678-80db3db210142fa5.js","3545","static/chunks/3545-9e4a648ea2701538.js","35","static/chunks/app/(v2)/(blog)/blog/page-6e2380a8fbf5f3da.js"],""]
b:"$Sreact.suspense"
c:I[82813,["7134","static/chunks/7134-7a2ccc87dc1f1c96.js","9657","static/chunks/9657-90d7d8e86cd8d7b3.js","3459","static/chunks/3459-aa0b1d8277b7bbbd.js","5519","static/chunks/app/(v2)/layout-24f9ee0b53a6742c.js"],"EmbedDetector"]
d:I[53696,["7134","static/chunks/7134-7a2ccc87dc1f1c96.js","9657","static/chunks/9657-90d7d8e86cd8d7b3.js","3459","static/chunks/3459-aa0b1d8277b7bbbd.js","5519","static/chunks/app/(v2)/layout-24f9ee0b53a6742c.js"],"Footer"]
f:I[93621,[],"MetadataBoundary"]
11:I[93621,[],"OutletBoundary"]
14:I[16867,[],"AsyncMetadataOutlet"]
16:I[93621,[],"ViewportBoundary"]
18:I[27890,[],""]
:HL["/_next/static/css/565f4925fe90494c.css","style"]
:HL["/_next/static/css/b2a053553e69c47d.css","style"]
:HL["/_next/static/css/9ded352fd1582faa.css","style"]
0:{"P":null,"b":"xyrr8R3WCFgaolPiXJ-Nn","p":"","c":["","blog","2025-06-02-faster-route-propagation-by-rewriting-our-traefik-gateway-in-rust",""],"i":false,"f":[[["",{"children":["(v2)",{"children":["(blog)",{"children":["blog",{"children":[["slug","2025-06-02-faster-route-propagation-by-rewriting-our-traefik-gateway-in-rust","c"],{"children":["__PAGE__",{}]}]}]}]}]},"$undefined","$undefined",true],["",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/565f4925fe90494c.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","html",null,{"lang":"en","className":"dark","children":[["$","head",null,{"children":[["$","$L2",null,{"gaId":"G-GHX1328ZFD"}],["$","$L3",null,{"src":"https://analytics.ahrefs.com/analytics.js","data-key":"wQAsHie9RgJMLNhmUbr/fQ","strategy":"beforeInteractive"}],["$","link",null,{"rel":"apple-touch-icon","sizes":"180x180","href":"/icons/apple-touch-icon.png?20240925"}],["$","link",null,{"rel":"icon","type":"image/png","sizes":"32x32","href":"/icons/favicon-32x32.png?20240925"}],["$","link",null,{"rel":"icon","type":"image/png","sizes":"16x16","href":"/icons/favicon-16x16.png?20240925"}],["$","link",null,{"rel":"manifest","href":"/icons/site.webmanifest?20240925"}],["$","link",null,{"rel":"mask-icon","href":"/icons/safari-pinned-tab.svg?20240925","color":"#5bbad5"}],["$","meta",null,{"name":"msapplication-TileColor","content":"#0c0a09"}],["$","meta",null,{"name":"theme-color","content":"#0c0a09"}],["$","meta",null,{"name":"viewport","content":"width=device-width, initial-scale=1.0"}]]}],["$","body",null,{"className":"dark","children":[["$","$L4",null,{"children":["$","$L5",null,{"children":["$","$L6",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L7",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":404}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],[]],"forbidden":"$undefined","unauthorized":"$undefined"}]}]}],["$","$L8",null,{"theme":"system","className":"toaster group right-8","toastOptions":{"classNames":{"toast":"group toast group-[.toaster]:bg-card group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg group-[.toaster]:border group-[.toaster]:rounded-md","description":"group-[.toast]:text-muted-foreground","actionButton":"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground","cancelButton":"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}}}]]}]]}]]}],{"children":["(v2)",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/b2a053553e69c47d.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}],["$","link","1",{"rel":"stylesheet","href":"/_next/static/css/9ded352fd1582faa.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],[["$","$L6",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L7",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[[["$","$L9",null,{"variant":"floating"}],["$","div",null,{"className":"relative flex min-h-[80vh] w-full items-center justify-center text-center","children":["$","div",null,{"className":"transition-opacity","children":[["$","h1",null,{"className":"mb-3 flex items-center justify-center text-3xl text-white","children":[["$","svg",null,{"aria-hidden":"true","focusable":"false","data-prefix":"fas","data-icon":"block-question","className":"svg-inline--fa fa-block-question mr-2 size-10","role":"img","xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 448 512","style":{},"ref":"$undefined","children":["$","path",null,{"fill":"currentColor","d":"M64 32C28.7 32 0 60.7 0 96L0 416c0 35.3 28.7 64 64 64l320 0c35.3 0 64-28.7 64-64l0-320c0-35.3-28.7-64-64-64L64 32zm73.8 149.3c7.9-22.3 29.1-37.3 52.8-37.3l58.3 0c34.9 0 63.1 28.3 63.1 63.1c0 22.6-12.1 43.5-31.7 54.8L248 280.4c-.2 13-10.9 23.6-24 23.6c-13.3 0-24-10.7-24-24l0-13.5c0-8.6 4.6-16.5 12.1-20.8l44.3-25.4c4.7-2.7 7.6-7.7 7.6-13.1c0-8.4-6.8-15.1-15.1-15.1l-58.3 0c-3.4 0-6.4 2.1-7.5 5.3l-.4 1.2c-4.4 12.5-18.2 19-30.6 14.6s-19-18.2-14.6-30.6l.4-1.2zM192 368a32 32 0 1 1 64 0 32 32 0 1 1 -64 0zM48 104a24 24 0 1 1 48 0 24 24 0 1 1 -48 0zM376 80a24 24 0 1 1 0 48 24 24 0 1 1 0-48zM48 408a24 24 0 1 1 48 0 24 24 0 1 1 -48 0zm328-24a24 24 0 1 1 0 48 24 24 0 1 1 0-48z","style":{}}]}]," ","Not Found"]}],["$","$La",null,{"aria-selected":false,"className":"relative inline-flex items-center justify-center gap-0.5 overflow-hidden font-semibold transition inline-flex items-center justify-center gap-0.5 rounded-sm px-3 py-1 text-sm font-semibold bg-transparent text-cream-100 border-2 border-cream-100 hover:bg-cream-100 hover:text-charcole-950","href":"/","children":[null,false,"Home",false]}]]}]}]],[]],"forbidden":"$undefined","unauthorized":"$undefined"}],["$","$b",null,{"children":["$","$Lc",null,{}]}],["$","$Ld",null,{}]]]}],{"children":["(blog)",["$","$1","c",{"children":[null,["$","$L6",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L7",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":["blog",["$","$1","c",{"children":[null,[["$","$L9",null,{"active":"blog","variant":"floating"}],["$","$L6",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L7",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]]}],{"children":[["slug","2025-06-02-faster-route-propagation-by-rewriting-our-traefik-gateway-in-rust","c"],["$","$1","c",{"children":[null,["$","$L6",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L7",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":["__PAGE__",["$","$1","c",{"children":["$Le",["$","$Lf",null,{"children":"$L10"}],null,["$","$L11",null,{"children":["$L12","$L13",["$","$L14",null,{"promise":"$@15"}]]}]]}],{},null,false]},null,false]},null,false]},null,false]},null,false]},null,false],["$","$1","h",{"children":[null,["$","$1","9bpgJ44RiymNtQbuJ3n3Y",{"children":[["$","$L16",null,{"children":"$L17"}],null]}],null]}],false]],"m":"$undefined","G":["$18","$undefined"],"s":false,"S":true}
19:I[16867,[],"AsyncMetadata"]
10:["$","$b",null,{"fallback":null,"children":["$","$L19",null,{"promise":"$@1a"}]}]
13:null
1b:I[1143,["1965","static/chunks/f67032f2-9c72234b0d8f41b4.js","7134","static/chunks/7134-7a2ccc87dc1f1c96.js","9078","static/chunks/9078-9c4b2ff48765f274.js","6855","static/chunks/6855-c97c866fb9680afe.js","5051","static/chunks/5051-51ff92d736937f41.js","9657","static/chunks/9657-90d7d8e86cd8d7b3.js","1983","static/chunks/1983-7439545cf8f39348.js","7678","static/chunks/7678-80db3db210142fa5.js","3545","static/chunks/3545-9e4a648ea2701538.js","35","static/chunks/app/(v2)/(blog)/blog/page-6e2380a8fbf5f3da.js"],"Avatar"]
1c:I[1143,["1965","static/chunks/f67032f2-9c72234b0d8f41b4.js","7134","static/chunks/7134-7a2ccc87dc1f1c96.js","9078","static/chunks/9078-9c4b2ff48765f274.js","6855","static/chunks/6855-c97c866fb9680afe.js","5051","static/chunks/5051-51ff92d736937f41.js","9657","static/chunks/9657-90d7d8e86cd8d7b3.js","1983","static/chunks/1983-7439545cf8f39348.js","7678","static/chunks/7678-80db3db210142fa5.js","3545","static/chunks/3545-9e4a648ea2701538.js","35","static/chunks/app/(v2)/(blog)/blog/page-6e2380a8fbf5f3da.js"],"AvatarFallback"]
1d:I[1143,["1965","static/chunks/f67032f2-9c72234b0d8f41b4.js","7134","static/chunks/7134-7a2ccc87dc1f1c96.js","9078","static/chunks/9078-9c4b2ff48765f274.js","6855","static/chunks/6855-c97c866fb9680afe.js","5051","static/chunks/5051-51ff92d736937f41.js","9657","static/chunks/9657-90d7d8e86cd8d7b3.js","1983","static/chunks/1983-7439545cf8f39348.js","7678","static/chunks/7678-80db3db210142fa5.js","3545","static/chunks/3545-9e4a648ea2701538.js","35","static/chunks/app/(v2)/(blog)/blog/page-6e2380a8fbf5f3da.js"],"AvatarImage"]
20:I[63571,["1965","static/chunks/f67032f2-9c72234b0d8f41b4.js","7134","static/chunks/7134-7a2ccc87dc1f1c96.js","9078","static/chunks/9078-9c4b2ff48765f274.js","6855","static/chunks/6855-c97c866fb9680afe.js","5051","static/chunks/5051-51ff92d736937f41.js","9657","static/chunks/9657-90d7d8e86cd8d7b3.js","1983","static/chunks/1983-7439545cf8f39348.js","7678","static/chunks/7678-80db3db210142fa5.js","3545","static/chunks/3545-9e4a648ea2701538.js","35","static/chunks/app/(v2)/(blog)/blog/page-6e2380a8fbf5f3da.js"],"Image"]
21:I[75036,["1965","static/chunks/f67032f2-9c72234b0d8f41b4.js","7134","static/chunks/7134-7a2ccc87dc1f1c96.js","9078","static/chunks/9078-9c4b2ff48765f274.js","6855","static/chunks/6855-c97c866fb9680afe.js","5051","static/chunks/5051-51ff92d736937f41.js","9657","static/chunks/9657-90d7d8e86cd8d7b3.js","1983","static/chunks/1983-7439545cf8f39348.js","7678","static/chunks/7678-80db3db210142fa5.js","3545","static/chunks/3545-9e4a648ea2701538.js","35","static/chunks/app/(v2)/(blog)/blog/page-6e2380a8fbf5f3da.js"],"Heading"]
22:I[28912,["1965","static/chunks/f67032f2-9c72234b0d8f41b4.js","7134","static/chunks/7134-7a2ccc87dc1f1c96.js","9078","static/chunks/9078-9c4b2ff48765f274.js","6855","static/chunks/6855-c97c866fb9680afe.js","5051","static/chunks/5051-51ff92d736937f41.js","9657","static/chunks/9657-90d7d8e86cd8d7b3.js","1983","static/chunks/1983-7439545cf8f39348.js","7678","static/chunks/7678-80db3db210142fa5.js","3545","static/chunks/3545-9e4a648ea2701538.js","35","static/chunks/app/(v2)/(blog)/blog/page-6e2380a8fbf5f3da.js"],"Accordion"]
23:I[32761,["1965","static/chunks/f67032f2-9c72234b0d8f41b4.js","7134","static/chunks/7134-7a2ccc87dc1f1c96.js","9078","static/chunks/9078-9c4b2ff48765f274.js","6855","static/chunks/6855-c97c866fb9680afe.js","5051","static/chunks/5051-51ff92d736937f41.js","9657","static/chunks/9657-90d7d8e86cd8d7b3.js","1983","static/chunks/1983-7439545cf8f39348.js","7678","static/chunks/7678-80db3db210142fa5.js","3545","static/chunks/3545-9e4a648ea2701538.js","35","static/chunks/app/(v2)/(blog)/blog/page-6e2380a8fbf5f3da.js"],"WithTooltip"]
24:I[30860,["1965","static/chunks/f67032f2-9c72234b0d8f41b4.js","7134","static/chunks/7134-7a2ccc87dc1f1c96.js","9078","static/chunks/9078-9c4b2ff48765f274.js","6855","static/chunks/6855-c97c866fb9680afe.js","5051","static/chunks/5051-51ff92d736937f41.js","9657","static/chunks/9657-90d7d8e86cd8d7b3.js","1983","static/chunks/1983-7439545cf8f39348.js","7678","static/chunks/7678-80db3db210142fa5.js","3545","static/chunks/3545-9e4a648ea2701538.js","35","static/chunks/app/(v2)/(blog)/blog/page-6e2380a8fbf5f3da.js"],"CopyCodeTrigger"]
25:I[63843,["1965","static/chunks/f67032f2-9c72234b0d8f41b4.js","7134","static/chunks/7134-7a2ccc87dc1f1c96.js","9078","static/chunks/9078-9c4b2ff48765f274.js","6855","static/chunks/6855-c97c866fb9680afe.js","5051","static/chunks/5051-51ff92d736937f41.js","9657","static/chunks/9657-90d7d8e86cd8d7b3.js","1983","static/chunks/1983-7439545cf8f39348.js","7678","static/chunks/7678-80db3db210142fa5.js","3545","static/chunks/3545-9e4a648ea2701538.js","35","static/chunks/app/(v2)/(blog)/blog/page-6e2380a8fbf5f3da.js"],"ScrollArea"]
29:I[49720,["1965","static/chunks/f67032f2-9c72234b0d8f41b4.js","8229","static/chunks/9da6db1e-dbfab9261a7c6a02.js","7134","static/chunks/7134-7a2ccc87dc1f1c96.js","9078","static/chunks/9078-9c4b2ff48765f274.js","6855","static/chunks/6855-c97c866fb9680afe.js","5051","static/chunks/5051-51ff92d736937f41.js","9657","static/chunks/9657-90d7d8e86cd8d7b3.js","1983","static/chunks/1983-7439545cf8f39348.js","7678","static/chunks/7678-80db3db210142fa5.js","3545","static/chunks/3545-9e4a648ea2701538.js","3733","static/chunks/3733-74f52baf8b8f8b32.js","5081","static/chunks/app/(v2)/(blog)/blog/%5B...slug%5D/page-dd20a2b305eff2bd.js"],"ArticleSocials"]
2a:I[9777,["1965","static/chunks/f67032f2-9c72234b0d8f41b4.js","8229","static/chunks/9da6db1e-dbfab9261a7c6a02.js","7134","static/chunks/7134-7a2ccc87dc1f1c96.js","9078","static/chunks/9078-9c4b2ff48765f274.js","6855","static/chunks/6855-c97c866fb9680afe.js","5051","static/chunks/5051-51ff92d736937f41.js","9657","static/chunks/9657-90d7d8e86cd8d7b3.js","1983","static/chunks/1983-7439545cf8f39348.js","7678","static/chunks/7678-80db3db210142fa5.js","3545","static/chunks/3545-9e4a648ea2701538.js","3733","static/chunks/3733-74f52baf8b8f8b32.js","5081","static/chunks/app/(v2)/(blog)/blog/%5B...slug%5D/page-dd20a2b305eff2bd.js"],"DocsTableOfContents"]
2b:I[19897,["1965","static/chunks/f67032f2-9c72234b0d8f41b4.js","8229","static/chunks/9da6db1e-dbfab9261a7c6a02.js","7134","static/chunks/7134-7a2ccc87dc1f1c96.js","9078","static/chunks/9078-9c4b2ff48765f274.js","6855","static/chunks/6855-c97c866fb9680afe.js","5051","static/chunks/5051-51ff92d736937f41.js","9657","static/chunks/9657-90d7d8e86cd8d7b3.js","1983","static/chunks/1983-7439545cf8f39348.js","7678","static/chunks/7678-80db3db210142fa5.js","3545","static/chunks/3545-9e4a648ea2701538.js","3733","static/chunks/3733-74f52baf8b8f8b32.js","5081","static/chunks/app/(v2)/(blog)/blog/%5B...slug%5D/page-dd20a2b305eff2bd.js"],"Comments"]
1e:T518,M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z26:T1c43,<pre class="shiki ayu-dark" style="background-color:#0c0a09;color:#bfbdb6" tabindex="0"><code><span class="line"><span style="color:#BFBDB6">{</span></span>
<span class="line"><span style="color:#39BAE6">  "http"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#39BAE6">    "services"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#39BAE6">      "job-run:00000000-0000-0000-0000-000000000000:game_default"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#39BAE6">        "loadBalancer"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> { </span><span style="color:#39BAE6">"servers"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> [ { </span><span style="color:#39BAE6">"url"</span><span style="color:#BFBDB6B3">:</span><span style="color:#AAD94C"> "http://10.0.0.1:24534"</span><span style="color:#BFBDB6"> } ]</span></span>
<span class="line"><span style="color:#BFBDB6">        }</span></span>
<span class="line"><span style="color:#BFBDB6">      }</span></span>
<span class="line"><span style="color:#BFBDB6">    }</span><span style="color:#BFBDB6B3">,</span></span>
<span class="line"><span style="color:#39BAE6">    "routers"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#39BAE6">      "job-run:00000000-0000-0000-0000-000000000000:example-hash-1:https"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#39BAE6">        "entryPoints"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> [ </span><span style="color:#AAD94C">"lb-443"</span><span style="color:#BFBDB6"> ]</span><span style="color:#BFBDB6B3">,</span></span>
<span class="line"><span style="color:#39BAE6">        "rule"</span><span style="color:#BFBDB6B3">:</span><span style="color:#AAD94C"> "Host(`11111111-1111-1111-1111-111111111111-default.lobby.22222222-2222-2222-2222-222222222222.rivet.run`)"</span><span style="color:#BFBDB6B3">,</span></span>
<span class="line"><span style="color:#39BAE6">        "service"</span><span style="color:#BFBDB6B3">:</span><span style="color:#AAD94C"> "job-run:00000000-0000-0000-0000-000000000000:game_default"</span><span style="color:#BFBDB6B3">,</span></span>
<span class="line"><span style="color:#39BAE6">        "middlewares"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> [ </span><span style="color:#AAD94C">"job-rate-limit"</span><span style="color:#BFBDB6B3">,</span><span style="color:#AAD94C"> "job-in-flight"</span><span style="color:#BFBDB6"> ]</span><span style="color:#BFBDB6B3">,</span></span>
<span class="line"><span style="color:#39BAE6">        "tls"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> { </span><span style="color:#39BAE6">"domains"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> [ { </span><span style="color:#39BAE6">"main"</span><span style="color:#BFBDB6B3">:</span><span style="color:#AAD94C"> "lobby.22222222-2222-2222-2222-222222222222.rivet.run"</span><span style="color:#BFBDB6B3">,</span><span style="color:#39BAE6"> "sans"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> [ </span><span style="color:#AAD94C">"*.lobby.22222222-2222-2222-2222-222222222222.rivet.run"</span><span style="color:#BFBDB6"> ] } ] }</span></span>
<span class="line"><span style="color:#BFBDB6">      }</span><span style="color:#BFBDB6B3">,</span></span>
<span class="line"><span style="color:#39BAE6">      "job-run:00000000-0000-0000-0000-000000000000:example-hash-2:https"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#39BAE6">        "entryPoints"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> [ </span><span style="color:#AAD94C">"lb-443"</span><span style="color:#BFBDB6"> ]</span><span style="color:#BFBDB6B3">,</span></span>
<span class="line"><span style="color:#39BAE6">        "rule"</span><span style="color:#BFBDB6B3">:</span><span style="color:#AAD94C"> "(Host(`lobby.22222222-2222-2222-2222-222222222222.rivet.run`) &#x26;&#x26; PathPrefix(`/11111111-1111-1111-1111-111111111111-default`))"</span><span style="color:#BFBDB6B3">,</span></span>
<span class="line"><span style="color:#39BAE6">        "service"</span><span style="color:#BFBDB6B3">:</span><span style="color:#AAD94C"> "job-run:00000000-0000-0000-0000-000000000000:game_default"</span><span style="color:#BFBDB6B3">,</span></span>
<span class="line"><span style="color:#39BAE6">        "middlewares"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> [ </span><span style="color:#AAD94C">"job-rate-limit"</span><span style="color:#BFBDB6B3">,</span><span style="color:#AAD94C"> "job-in-flight"</span><span style="color:#BFBDB6B3">,</span><span style="color:#AAD94C"> "job-run-strip-prefix:00000000-0000-0000-0000-000000000000:example-hash-3"</span><span style="color:#BFBDB6"> ]</span><span style="color:#BFBDB6B3">,</span></span>
<span class="line"><span style="color:#39BAE6">        "tls"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> { </span><span style="color:#39BAE6">"domains"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> [ { </span><span style="color:#39BAE6">"main"</span><span style="color:#BFBDB6B3">:</span><span style="color:#AAD94C"> "lobby.22222222-2222-2222-2222-222222222222.rivet.run/11111111-1111-1111-1111-111111111111-default"</span><span style="color:#BFBDB6B3">,</span><span style="color:#39BAE6"> "sans"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> [] } ] }</span></span>
<span class="line"><span style="color:#BFBDB6">      }</span></span>
<span class="line"><span style="color:#BFBDB6">    }</span><span style="color:#BFBDB6B3">,</span></span>
<span class="line"><span style="color:#39BAE6">    "middlewares"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#39BAE6">      "job-run-strip-prefix:00000000-0000-0000-0000-000000000000:example-hash-3"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#39BAE6">        "stripPrefix"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> { </span><span style="color:#39BAE6">"prefixes"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> [ </span><span style="color:#AAD94C">"/11111111-1111-1111-1111-111111111111-default"</span><span style="color:#BFBDB6"> ] }</span></span>
<span class="line"><span style="color:#BFBDB6">      }</span></span>
<span class="line"><span style="color:#BFBDB6">    }</span></span>
<span class="line"><span style="color:#BFBDB6">  }</span></span>
<span class="line"><span style="color:#BFBDB6">}</span></span>
<span class="line"></span></code></pre>27:T2161,<pre class="shiki ayu-dark" style="background-color:#0c0a09;color:#bfbdb6" tabindex="0"><code><span class="line"><span style="color:#BFBDB6">#[tokio</span><span style="color:#F29668">::</span><span style="color:#BFBDB6">main]</span></span>
<span class="line"><span style="color:#FF8F40">async</span><span style="color:#FF8F40"> fn</span><span style="color:#FFB454"> main</span><span style="color:#BFBDB6">() </span><span style="color:#F29668">-></span><span style="color:#59C2FF"> Result</span><span style="color:#BFBDB6">&#x3C;()> {</span></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">	// Routing</span></span>
<span class="line"><span style="color:#FF8F40">	let</span><span style="color:#BFBDB6"> routing_fn </span><span style="color:#F29668">=</span><span style="color:#F29668"> |</span><span style="color:#BFBDB6">hostname</span><span style="color:#F29668">:</span><span style="color:#F29668"> &#x26;</span><span style="color:#59C2FF">str</span><span style="color:#BFBDB6">, path</span><span style="color:#F29668">:</span><span style="color:#F29668"> &#x26;</span><span style="color:#59C2FF">str</span><span style="color:#BFBDB6">, port_type</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> rivet_guard_core</span><span style="color:#F29668">::</span><span style="color:#59C2FF">proxy_service</span><span style="color:#F29668">::</span><span style="color:#59C2FF">PortType</span><span style="color:#F29668">|</span><span style="color:#FF8F40"> async</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">		// ...fetch routes here...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59C2FF">		Ok</span><span style="color:#BFBDB6">(</span><span style="color:#59C2FF">Some</span><span style="color:#BFBDB6">(</span><span style="color:#59C2FF">RoutingOutput</span><span style="color:#F29668">::</span><span style="color:#FFB454">Route</span><span style="color:#BFBDB6">(</span><span style="color:#59C2FF">RouteConfig</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#BFBDB6">			targets</span><span style="color:#F29668">:</span><span style="color:#FFB454"> vec!</span><span style="color:#BFBDB6">[</span></span>
<span class="line"><span style="color:#59C2FF">				RouteTarget</span><span style="color:#BFBDB6"> { host, port, path },</span></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">				// ...more targets...</span></span>
<span class="line"><span style="color:#BFBDB6">			],</span></span>
<span class="line"><span style="color:#BFBDB6">			timeout</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> RoutingTimeout</span><span style="color:#BFBDB6"> { routing_timeout },</span></span>
<span class="line"><span style="color:#BFBDB6">		})))</span></span>
<span class="line"><span style="color:#BFBDB6">	};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">	// Middleware</span></span>
<span class="line"><span style="color:#FF8F40">	let</span><span style="color:#BFBDB6"> middleware_fn </span><span style="color:#F29668">=</span><span style="color:#F29668"> |</span><span style="color:#BFBDB6">actor_id</span><span style="color:#F29668">:</span><span style="color:#F29668"> &#x26;</span><span style="color:#59C2FF">uuid</span><span style="color:#F29668">::</span><span style="color:#59C2FF">Uuid</span><span style="color:#F29668">|</span><span style="color:#FF8F40"> async</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">		// ...fetch middleware configuration...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59C2FF">		Ok</span><span style="color:#BFBDB6">(</span><span style="color:#59C2FF">MiddlewareResponse</span><span style="color:#F29668">::</span><span style="color:#59C2FF">Ok</span><span style="color:#BFBDB6">(</span><span style="color:#59C2FF">MiddlewareConfig</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#BFBDB6">			rate_limit</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> RateLimitConfig</span><span style="color:#BFBDB6"> { requests, period },</span></span>
<span class="line"><span style="color:#BFBDB6">			max_in_flight</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> MaxInFlightConfig</span><span style="color:#BFBDB6"> { amount },</span></span>
<span class="line"><span style="color:#BFBDB6">			retry</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> RetryConfig</span><span style="color:#BFBDB6"> { max_attempts, initial_interval },</span></span>
<span class="line"><span style="color:#BFBDB6">			timeout</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> TimeoutConfig</span><span style="color:#BFBDB6"> { request_timeout },</span></span>
<span class="line"><span style="color:#BFBDB6">		}))</span></span>
<span class="line"><span style="color:#BFBDB6">	};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">	// TLS certificates</span></span>
<span class="line"><span style="color:#FF8F40">	let</span><span style="color:#BFBDB6"> cert </span><span style="color:#F29668">=</span><span style="color:#FFB454"> load_certified_key</span><span style="color:#BFBDB6">(</span><span style="color:#F29668">&#x26;</span><span style="color:#59C2FF">CertificatePair</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#BFBDB6">		name</span><span style="color:#F29668">:</span><span style="color:#AAD94C"> "My Cert"</span><span style="color:#BFBDB6">,</span></span>
<span class="line"><span style="color:#BFBDB6">		cert_path</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> Path</span><span style="color:#F29668">::</span><span style="color:#FFB454">new</span><span style="color:#BFBDB6">(</span><span style="color:#F29668">&#x26;</span><span style="color:#BFBDB6">tls_config</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">actor_cert_path)</span><span style="color:#F29668">.</span><span style="color:#FFB454">into</span><span style="color:#BFBDB6">(),</span></span>
<span class="line"><span style="color:#BFBDB6">		key_path</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> Path</span><span style="color:#F29668">::</span><span style="color:#FFB454">new</span><span style="color:#BFBDB6">(</span><span style="color:#F29668">&#x26;</span><span style="color:#BFBDB6">tls_config</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">actor_key_path)</span><span style="color:#F29668">.</span><span style="color:#FFB454">into</span><span style="color:#BFBDB6">(),</span></span>
<span class="line"><span style="color:#BFBDB6">	})</span><span style="color:#F29668">?</span><span style="color:#BFBDB6">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF8F40">	let</span><span style="color:#BFBDB6"> cert_resolver_fn </span><span style="color:#F29668">=</span><span style="color:#FF8F40"> move</span><span style="color:#F29668"> |</span><span style="color:#BFBDB6">hostname</span><span style="color:#F29668">:</span><span style="color:#F29668"> &#x26;</span><span style="color:#59C2FF">str</span><span style="color:#F29668">|</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">		// ... match hostname to the appropriate cert...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59C2FF">		Ok</span><span style="color:#BFBDB6">(cert</span><span style="color:#F29668">.</span><span style="color:#FFB454">clone</span><span style="color:#BFBDB6">())</span></span>
<span class="line"><span style="color:#BFBDB6">	};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">	// Start server</span></span>
<span class="line"><span style="color:#59C2FF">	rivet_guard_core</span><span style="color:#F29668">::</span><span style="color:#FFB454">run_server</span><span style="color:#BFBDB6">(config, routing_fn, middleware_fn, cert_resolver_fn)</span><span style="color:#F29668">.</span><span style="color:#FF8F40">await</span><span style="color:#F29668">?</span></span>
<span class="line"><span style="color:#BFBDB6">}</span></span>
<span class="line"></span></code></pre>28:T1e9e,<pre class="shiki ayu-dark" style="background-color:#0c0a09;color:#bfbdb6" tabindex="0"><code><span class="line"><span style="color:#FF8F40">let</span><span style="color:#BFBDB6"> routing_fn </span><span style="color:#F29668">=</span><span style="color:#F29668"> |</span><span style="color:#BFBDB6">hostname</span><span style="color:#F29668">:</span><span style="color:#F29668"> &#x26;</span><span style="color:#59C2FF">str</span><span style="color:#BFBDB6">, path</span><span style="color:#F29668">:</span><span style="color:#F29668"> &#x26;</span><span style="color:#59C2FF">str</span><span style="color:#BFBDB6">, port_type</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> rivet_guard_core</span><span style="color:#F29668">::</span><span style="color:#59C2FF">proxy_service</span><span style="color:#F29668">::</span><span style="color:#59C2FF">PortType</span><span style="color:#F29668">|</span><span style="color:#FF8F40"> async</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#FF8F40">	match</span><span style="color:#59C2FF"> actor_routes</span><span style="color:#F29668">::</span><span style="color:#FFB454">route_via_route_config</span><span style="color:#BFBDB6">(</span><span style="color:#F29668">&#x26;</span><span style="color:#BFBDB6">ctx, host, path, dc_id)</span><span style="color:#F29668">.</span><span style="color:#FF8F40">await</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#59C2FF">		Ok</span><span style="color:#BFBDB6">(</span><span style="color:#59C2FF">Some</span><span style="color:#BFBDB6">(x)) </span><span style="color:#F29668">=></span><span style="color:#BFBDB6"> { </span><span style="color:#FF8F40">return</span><span style="color:#59C2FF"> Ok</span><span style="color:#BFBDB6">(x); }</span></span>
<span class="line"><span style="color:#59C2FF">		Ok</span><span style="color:#BFBDB6">(</span><span style="color:#59C2FF">None</span><span style="color:#BFBDB6">) </span><span style="color:#F29668">=></span><span style="color:#BFBDB6"> { </span><span style="color:#ACB6BF8C;font-style:italic">/* Continue to next routing method */</span><span style="color:#BFBDB6"> }</span></span>
<span class="line"><span style="color:#59C2FF">		Err</span><span style="color:#BFBDB6">(err) </span><span style="color:#F29668">=></span><span style="color:#BFBDB6"> { </span><span style="color:#FF8F40">return</span><span style="color:#59C2FF"> Ok</span><span style="color:#BFBDB6">(</span><span style="color:#FFB454">error_response</span><span style="color:#BFBDB6">(err)); }</span></span>
<span class="line"><span style="color:#BFBDB6">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF8F40">	match</span><span style="color:#59C2FF"> actor</span><span style="color:#F29668">::</span><span style="color:#FFB454">route_actor_request</span><span style="color:#BFBDB6">(</span><span style="color:#F29668">&#x26;</span><span style="color:#BFBDB6">ctx, host, path, dc_id)</span><span style="color:#F29668">.</span><span style="color:#FF8F40">await</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#59C2FF">		Ok</span><span style="color:#BFBDB6">(</span><span style="color:#59C2FF">Some</span><span style="color:#BFBDB6">(x)) </span><span style="color:#F29668">=></span><span style="color:#BFBDB6"> { </span><span style="color:#FF8F40">return</span><span style="color:#59C2FF"> Ok</span><span style="color:#BFBDB6">(x); }</span></span>
<span class="line"><span style="color:#59C2FF">		Ok</span><span style="color:#BFBDB6">(</span><span style="color:#59C2FF">None</span><span style="color:#BFBDB6">) </span><span style="color:#F29668">=></span><span style="color:#BFBDB6"> { </span><span style="color:#ACB6BF8C;font-style:italic">/* Continue to next routing method */</span><span style="color:#BFBDB6"> }</span></span>
<span class="line"><span style="color:#59C2FF">		Err</span><span style="color:#BFBDB6">(err) </span><span style="color:#F29668">=></span><span style="color:#BFBDB6"> { </span><span style="color:#FF8F40">return</span><span style="color:#59C2FF"> Ok</span><span style="color:#BFBDB6">(</span><span style="color:#FFB454">error_response</span><span style="color:#BFBDB6">(err)); }</span></span>
<span class="line"><span style="color:#BFBDB6">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF8F40">	match</span><span style="color:#59C2FF"> api</span><span style="color:#F29668">::</span><span style="color:#FFB454">route_api_request</span><span style="color:#BFBDB6">(</span><span style="color:#F29668">&#x26;</span><span style="color:#BFBDB6">ctx, host, path, </span><span style="color:#F29668">&#x26;</span><span style="color:#BFBDB6">dc</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">name_id, dc_id)</span><span style="color:#F29668">.</span><span style="color:#FF8F40">await</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#59C2FF">		Ok</span><span style="color:#BFBDB6">(</span><span style="color:#59C2FF">Some</span><span style="color:#BFBDB6">(x)) </span><span style="color:#F29668">=></span><span style="color:#BFBDB6"> { </span><span style="color:#FF8F40">return</span><span style="color:#59C2FF"> Ok</span><span style="color:#BFBDB6">(x); }</span></span>
<span class="line"><span style="color:#59C2FF">		Ok</span><span style="color:#BFBDB6">(</span><span style="color:#59C2FF">None</span><span style="color:#BFBDB6">) </span><span style="color:#F29668">=></span><span style="color:#BFBDB6"> { </span><span style="color:#ACB6BF8C;font-style:italic">/* Continue to next routing method */</span><span style="color:#BFBDB6"> }</span></span>
<span class="line"><span style="color:#59C2FF">		Err</span><span style="color:#BFBDB6">(err) </span><span style="color:#F29668">=></span><span style="color:#BFBDB6"> { </span><span style="color:#FF8F40">return</span><span style="color:#59C2FF"> Ok</span><span style="color:#BFBDB6">(</span><span style="color:#FFB454">error_response</span><span style="color:#BFBDB6">(err)); }</span></span>
<span class="line"><span style="color:#BFBDB6">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">	// No matching route found</span></span>
<span class="line"><span style="color:#59C2FF">	Ok</span><span style="color:#BFBDB6">(</span><span style="color:#59C2FF">RoutingOutput</span><span style="color:#F29668">::</span><span style="color:#FFB454">Response</span><span style="color:#BFBDB6">(</span><span style="color:#59C2FF">StructuredResponse</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#BFBDB6">		status</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> StatusCode</span><span style="color:#F29668">::</span><span style="color:#95E6CB">NOT_FOUND</span><span style="color:#BFBDB6">,</span></span>
<span class="line"><span style="color:#BFBDB6">		message</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> Cow</span><span style="color:#F29668">::</span><span style="color:#FFB454">Owned</span><span style="color:#BFBDB6">(</span><span style="color:#FFB454">format!</span><span style="color:#BFBDB6">(</span></span>
<span class="line"><span style="color:#AAD94C">			"No route found for hostname: {host}, path: {path}"</span></span>
<span class="line"><span style="color:#BFBDB6">		)),</span></span>
<span class="line"><span style="color:#BFBDB6">		docs</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> None</span><span style="color:#BFBDB6">,</span></span>
<span class="line"><span style="color:#BFBDB6">	}))</span></span>
<span class="line"><span style="color:#BFBDB6">};</span></span>
<span class="line"></span></code></pre>e:[["$","div",null,{"className":"mx-auto mt-20 w-full max-w-6xl px-4 md:mt-32 max-w-[1440px]","style":{"--header-height":"5rem"},"children":[["$","ul",null,{"className":"text-muted-foreground my-4 flex flex-wrap items-center gap-2 text-xs","children":[["$","li",null,{"children":["$","$La",null,{"href":"/blog","children":"Blog"}]}],["$","li",null,{"className":"h-2.5","children":["$","svg",null,{"aria-hidden":"true","focusable":"false","data-prefix":"fas","data-icon":"chevron-right","className":"svg-inline--fa fa-chevron-right block h-full w-auto","role":"img","xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 320 512","style":{},"ref":"$undefined","children":["$","path",null,{"fill":"currentColor","d":"M310.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-192 192c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L242.7 256 73.4 86.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l192 192z","style":{}}]}]}],["$","li",null,{"children":"Technical"}],["$","li",null,{"className":"h-2.5","children":["$","svg",null,{"aria-hidden":"true","focusable":"false","data-prefix":"fas","data-icon":"chevron-right","className":"svg-inline--fa fa-chevron-right block h-full w-auto","role":"img","xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 320 512","style":{},"ref":"$undefined","children":["$","path",null,{"fill":"currentColor","d":"M310.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-192 192c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L242.7 256 73.4 86.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l192 192z","style":{}}]}]}],["$","li",null,{"className":"text-foreground font-semibold","children":"2,000x faster route propagation by rewriting our Traefik gateway in Rust"}]]}],["$","div",null,{"className":"flex flex-col gap-8 pb-6 lg:flex-row","children":[["$","aside",null,{"className":"order-1 mt-2 flex min-w-0 max-w-s flex-1 flex-col gap-2","children":["$","div",null,{"className":"top-header sticky pt-2","children":[["$","p",null,{"className":"mb-2 text-sm font-semibold","children":"Posted by"}],["$","div",null,{"className":"mb-4 flex items-center gap-2","children":[["$","$L1b",null,{"className":"mt-1 size-14","children":[["$","$L1c",null,{"children":"$undefined"}],["$","$L1d",null,{"src":"/_next/static/media/avatar.7191d056.jpeg","height":1516,"width":1516,"blurDataURL":"data:image/jpeg;base64,/9j/2wBDAAoKCgoKCgsMDAsPEA4QDxYUExMUFiIYGhgaGCIzICUgICUgMy03LCksNy1RQDg4QFFeT0pPXnFlZXGPiI+7u/v/2wBDAQoKCgoKCgsMDAsPEA4QDxYUExMUFiIYGhgaGCIzICUgICUgMy03LCksNy1RQDg4QFFeT0pPXnFlZXGPiI+7u/v/wgARCAAIAAgDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAb/xAAVAQEBAAAAAAAAAAAAAAAAAAAEBf/aAAwDAQACEAMQAAAApxJX/8QAHBAAAgICAwAAAAAAAAAAAAAAAQIDEgAEBREj/9oACAEBAAE/AIG3H5iX2rpIoRIq1UmvbHP/xAAXEQADAQAAAAAAAAAAAAAAAAAAAhNh/9oACAECAQE/AKNh/8QAGBEAAgMAAAAAAAAAAAAAAAAAAAIBIXH/2gAIAQMBAT8AlFrD/9k=","blurWidth":8,"blurHeight":8,"alt":{"name":"Nathan Flurry","role":"Co-founder & CTO","avatar":{"src":"/_next/static/media/avatar.7191d056.jpeg","height":1516,"width":1516,"blurDataURL":"data:image/jpeg;base64,/9j/2wBDAAoKCgoKCgsMDAsPEA4QDxYUExMUFiIYGhgaGCIzICUgICUgMy03LCksNy1RQDg4QFFeT0pPXnFlZXGPiI+7u/v/2wBDAQoKCgoKCgsMDAsPEA4QDxYUExMUFiIYGhgaGCIzICUgICUgMy03LCksNy1RQDg4QFFeT0pPXnFlZXGPiI+7u/v/wgARCAAIAAgDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAb/xAAVAQEBAAAAAAAAAAAAAAAAAAAEBf/aAAwDAQACEAMQAAAApxJX/8QAHBAAAgICAwAAAAAAAAAAAAAAAQIDEgAEBREj/9oACAEBAAE/AIG3H5iX2rpIoRIq1UmvbHP/xAAXEQADAQAAAAAAAAAAAAAAAAAAAhNh/9oACAECAQE/AKNh/8QAGBEAAgMAAAAAAAAAAAAAAAAAAAIBIXH/2gAIAQMBAT8AlFrD/9k=","blurWidth":8,"blurHeight":8},"socials":{"twitter":"https://x.com/NathanFlurry/","github":"https://github.com/nathanflurry","bluesky":"https://bsky.app/profile/nathanflurry.com"}}}]]}],["$","div",null,{"className":"flex flex-col","children":[["$","h3",null,{"className":"font-bold","children":"Nathan Flurry"}],["$","p",null,{"className":"text-muted-foreground text-sm","children":"Co-founder & CTO"}],["$","p",null,{"className":"flex gap-2 text-xs text-muted-foreground mt-1","children":[["$","a",null,{"href":"https://x.com/NathanFlurry/","target":"_blank","rel":"noopener noreferrer","children":["$","svg",null,{"aria-hidden":"true","focusable":"false","data-prefix":"fab","data-icon":"x-twitter","className":"svg-inline--fa fa-x-twitter ","role":"img","xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 512 512","style":{},"ref":"$undefined","children":["$","path",null,{"fill":"currentColor","d":"M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z","style":{}}]}]}],["$","a",null,{"href":"https://bsky.app/profile/nathanflurry.com","target":"_blank","rel":"noopener noreferrer","children":["$","svg",null,{"aria-hidden":"true","focusable":"false","data-prefix":"fab","data-icon":"bluesky","className":"svg-inline--fa fa-bluesky ","role":"img","xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 512 512","style":{},"ref":"$undefined","children":["$","path",null,{"fill":"currentColor","d":"M111.8 62.2C170.2 105.9 233 194.7 256 242.4c23-47.6 85.8-136.4 144.2-180.2c42.1-31.6 110.3-56 110.3 21.8c0 15.5-8.9 130.5-14.1 149.2C478.2 298 412 314.6 353.1 304.5c102.9 17.5 129.1 75.5 72.5 133.5c-107.4 110.2-154.3-27.6-166.3-62.9l0 0c-1.7-4.9-2.6-7.8-3.3-7.8s-1.6 3-3.3 7.8l0 0c-12 35.3-59 173.1-166.3 62.9c-56.5-58-30.4-116 72.5-133.5C100 314.6 33.8 298 15.7 233.1C10.4 214.4 1.5 99.4 1.5 83.9c0-77.8 68.2-53.4 110.3-21.8z","style":{}}]}]}],["$","a",null,{"href":"https://github.com/nathanflurry","target":"_blank","rel":"noopener noreferrer","children":["$","svg",null,{"aria-hidden":"true","focusable":"false","data-prefix":"fab","data-icon":"github","className":"svg-inline--fa fa-github ","role":"img","xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 496 512","style":{},"ref":"$undefined","children":["$","path",null,{"fill":"currentColor","d":"$1e","style":{}}]}]}]]}]]}]]}],["$","div",null,{"className":"text-muted-foreground mb-6 flex items-center gap-2 text-sm","children":[["$","svg",null,{"aria-hidden":"true","focusable":"false","data-prefix":"fas","data-icon":"calendar-day","className":"svg-inline--fa fa-calendar-day ","role":"img","xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 448 512","style":{},"ref":"$undefined","children":["$","path",null,{"fill":"currentColor","d":"M128 0c17.7 0 32 14.3 32 32l0 32 128 0 0-32c0-17.7 14.3-32 32-32s32 14.3 32 32l0 32 48 0c26.5 0 48 21.5 48 48l0 48L0 160l0-48C0 85.5 21.5 64 48 64l48 0 0-32c0-17.7 14.3-32 32-32zM0 192l448 0 0 272c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 192zm80 64c-8.8 0-16 7.2-16 16l0 96c0 8.8 7.2 16 16 16l96 0c8.8 0 16-7.2 16-16l0-96c0-8.8-7.2-16-16-16l-96 0z","style":{}}]}],["$","time",null,{"className":"text-sm","children":"June 2, 2025"}]]}],["$","p",null,{"className":"mb-2 hidden text-sm font-semibold lg:block","children":"Other articles"}],"$L1f"]}]}],["$","article",null,{"className":"order-3 mt-4 w-full flex-shrink-0 lg:order-2 xl:max-w-[1000px] prose-invert prose","children":[["$","$L20",null,{"src":"/_next/static/media/image.c02c4de6.png","height":1024,"width":2048,"blurDataURL":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAECAMAAACEE47CAAAAElBMVEUTExMaGBgeHyA3HxYmJiY1NTWHGKItAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIklEQVR4nBXJwREAMAzCMBvI/iv3qq8AFGQ3TcLdbJX8qzwD1wA3Cc9QnQAAAABJRU5ErkJggg==","blurWidth":8,"blurHeight":4,"alt":"Promo Image","className":"rounded-xl border border-white/10"}],[["$","h1",null,{"children":"2,000x faster route propagation by rewriting our Traefik gateway in Rust"}],"\n",["$","p",null,{"children":["$","strong",null,{"children":["Rivet is an open-source, self-hostable serverless platform that supports ",["$","$La",null,{"href":"/docs/cloud/functions","children":"Rivet Functions"}],", ",["$","$La",null,{"href":"/docs/actors","children":"Rivet Actors"}]," (open-source Cloudflare Durable Objects), and ",["$","$La",null,{"href":"/docs/cloud/containers","children":"Rivet Containers"}],". We've rewritten our Traefik-based gateway in Rust  now named Rivet Guard  to support the hyper-specific needs of building a serverless platform."]}]}],"\n",["$","$L21",null,{"level":2,"id":"what-is-rivet-guard","children":"What is Rivet Guard"}],"\n",["$","p",null,{"children":"Rivet Guard is our gateway service that handles all incoming traffic to the Rivet platform. Its core responsibilities include:"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","strong",null,{"children":[["$","$La",null,{"href":"/docs/cloud/functions","children":"Rivet Function"}]," Routing"]}],": Routing the appropriate paths + hostnames to the correct Rivet Function"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":[["$","$La",null,{"href":"/docs/actors","children":"Rivet Actors"}]," & ",["$","$La",null,{"href":"/docs/cloud/containers","children":"Rivet Containers"}]," Routing"]}],": Route incoming requests to the correct Rivet Actor or Rivet Container"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"Rivet API"}],": Route API endpoints to the Rivet API server"]}],"\n"]}],"\n",["$","$L21",null,{"level":2,"id":"the-problem-with-traefik","children":"The Problem with Traefik"}],"\n",["$","p",null,{"children":"Traefik is a widely used reverse proxy that makes it incredibly easy to set up load balancing & routing in a variety of environments."}],"\n",["$","p",null,{"children":"To ship the original version of Rivet, we chose Traefik because of its ease of use for configuring dynamic routes. We always knew this was a temporary solution until we could write a more mature gateway ourselves."}],"\n",["$","$L21",null,{"level":3,"id":"architecture-with-traefik-http-provider","children":"Architecture with Traefik HTTP Provider"}],"\n",["$","p",null,{"children":["We took advantage of the ",["$","$La",null,{"href":"https://doc.traefik.io/traefik/providers/http/","children":"Traefik HTTP provider"}]," to dynamically configure routes for the MVP of Rivet. Our setup consisted of 3 components:"]}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","strong",null,{"children":"Traefik"}],": Acts as a gateway for proxying requests from clients to the appropriate Rivet Function, Actor, Container, or API endpoint"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"HTTP provider"}],": An HTTP API that Traefik polls every 500 ms to pull the available routes","\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"Responds with a \"state of the world\" that includes all of the routes, middleware, and services."}],"\n",["$","li",null,{"children":"Includes an in-process memory cache of available routes"}],"\n"]}],"\n"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"NATS Cache Pub/Sub Topic for purging"}],": NATS provides a topic to notify the HTTP API that the routes have updated and the in-memory cache needs to be purged"]}],"\n"]}],"\n",["$","div",null,{"className":"max-w-3xl mx-auto mx-auto py-6","children":["$","div",null,{"className":"not-prose relative bg-white/5 rounded-xl overflow-hidden border border-white/10 overflow-hidden","children":[["$","div",null,{"className":"relative flex justify-center border-b border-white/5","children":["$","$L20",null,{"src":{"src":"/_next/static/media/traefik-arch.c1b6739c.svg","height":798,"width":1380,"blurWidth":0,"blurHeight":0},"alt":"Architecture of Traefik, API server, and NATS"}]}],["$","div",null,{"className":"relative rounded-xl overflow-auto flex justify-center text-sm text-slate-400 px-4 py-4","children":["$","p",null,{"children":"Old Gateway Architecture With Traefik"}]}]]}]}],"\n",["$","$L21",null,{"level":3,"id":"where-traefik-started-getting-jammed","children":"Where Traefik Started Getting Jammed"}],"\n",["$","p",null,{"children":["$","strong",null,{"children":"Part 1: Slow route propagation"}]}],"\n",["$","p",null,{"children":"It's incredibly important that Rivet Functions, Actors, and Containers are immediately available when provisioned. We put a lot of work into our infrastructure to make this happen, but Traefik has always been the one piece that slowed down how fast we can make resources available."}],"\n",["$","p",null,{"children":["Under the hood, we had Traefik configured to poll at a 500 ms interval and ",["$","$La",null,{"href":"https://doc.traefik.io/traefik/providers/overview/#providersprovidersthrottleduration","children":["$","code",null,{"dangerouslySetInnerHTML":{"__html":"providersThrottleDuration"}}]}]," configured to ",["$","code",null,{"dangerouslySetInnerHTML":{"__html":"0.025s"}}],". If we tried to set the interval any faster, it caused internal backpressure. Despite being configured as such, Traefik does not expose routes within 500 ms in practice. Instead, we found it reliably taking between 1-2 seconds. Therefore, we ",["$","strong",null,{"children":"had to add an artificial timeout of 2 seconds just to wait for our routes to propagate reliably"}]," within that time window."]}],"\n",["$","p",null,{"children":"All of the work we had put into making our backend & infrastructure provision resources blazing fast was going to waste with a measly timeout."}],"\n",["$","p",null,{"children":["$","strong",null,{"children":"Part 2: Large HTTP provider responses"}]}],"\n",["$","p",null,{"children":"Every single route available on Traefik required a configuration entry for:"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"A route entry"}],"\n",["$","li",null,{"children":"A service entry"}],"\n",["$","li",null,{"children":"Custom middleware for in-flight request limits (configurable by developers)"}],"\n"]}],"\n",["$","p",null,{"children":"These routes come out to a minimum 1.3 KB of JSON per route  assuming the developer has not configured additional middleware."}],"\n",["$","$L22",null,{"title":"Example HTTP route","children":[["$","p",null,{"children":"A single route looks roughly like this:"}],["$","div",null,{"className":"not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none","data-code-group":true,"children":[["$","div",null,{"className":"text-foreground flex items-center justify-between gap-2 border-b p-2 text-xs","children":[["$","div",null,{"className":"text-muted-foreground flex items-center gap-1","children":["$","div",null,{"ref":"$undefined","className":"inline-flex items-center tracking-normal rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-nowrap max-w-full overflow-hidden truncate text-foreground","children":"JSON"}]}],["$","$L23",null,{"trigger":["$","$L24",null,{"children":["$","button",null,{"className":"group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&_svg]:size-3 gap-1.5","ref":"$undefined","disabled":"$undefined","children":[null,["$","svg",null,{"aria-hidden":"true","focusable":"false","data-prefix":"fas","data-icon":"copy","className":"svg-inline--fa fa-copy ","role":"img","xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 448 512","style":{},"ref":"$undefined","children":["$","path",null,{"fill":"currentColor","d":"M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z","style":{}}]}],null]}]}],"content":"Copy code"}]]}],["$","div",null,{"className":"bg-background text-wrap p-2 text-sm","children":["$","$L25",null,{"className":"w-full","children":["$","span",null,{"className":"not-prose code","dangerouslySetInnerHTML":{"__html":"$26"}}]}]}]]}]]}],"\n",["$","p",null,{"children":["At ",["$","strong",null,{"children":"around 3 MB JSON responses"}]," (just over 100 routes, or 800 routes spread across our 8 regions), Traefik's latency started to increase noticeably."]}],"\n",["$","p",null,{"children":["Our load tests had previously shown that ",["$","strong",null,{"children":"Traefik completely stops working once your HTTP provider JSON config hits ~14 MB"}],", so we knew it was time to upgrade the Rivet gateway or bad things would happen."]}],"\n",["$","$L21",null,{"level":2,"id":"redesigning-from-the-ground-up","children":"Redesigning from the Ground Up"}],"\n",["$","p",null,{"children":"When designing Rivet Guard, we wanted it to support:"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","strong",null,{"children":"Fast route propagation"}],": Routes should be available immediately without having to wait for them to propagate"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"Infinite routes"}],": Vital for the amount of Rivet Actors that developers are creating"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"Stateless"}],": No complex route materialization or config generation"]}],"\n"]}],"\n",["$","$L21",null,{"level":2,"id":"architecture","children":"Architecture"}],"\n",["$","p",null,{"children":"Rivet Guard is built differently than most other proxies: it's built as a library that we can internally plug in our own custom routing handlers. Its routes are lazily resolved & cached instead of being kept in memory."}],"\n",["$","$L21",null,{"level":3,"id":"lazy-routing","children":"Lazy routing"}],"\n",["$","p",null,{"children":["When a request is made to Rivet Guard, it will call a user-provided function called ",["$","code",null,{"dangerouslySetInnerHTML":{"__html":"routing_fn"}}]," that will return the endpoint to connect to lazily. This endpoint will be cached for future requests."]}],"\n",["$","p",null,{"children":"In contrast to the previous Traefik configuration, this provides the following benefits:"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","strong",null,{"children":"Simpler architecture"}],": Simplifying from 3 components (Traefik, API, NATS)  1 component (Rivet Guard)"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"Completely stateless"}],": Routes are fetched & cached on demand"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"Scales"}],": Infinite number of routes"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"Flexible"}],": We can parse & generate routes in any way that you can with code, e.g. regex, dynamic route lookups, etc."]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"Easy to debug"}],": We can use our existing monitoring stack"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"Configuration-free"}],": \"Configuring\" Rivet Guard is just writing code without the sharp edges that configuring things like Traefik routes has"]}],"\n"]}],"\n",["$","p",null,{"children":["When configured with a ",["$","code",null,{"dangerouslySetInnerHTML":{"__html":"routing_fn"}}]," that can resolve routes from an external datasource, the new gateway architecture for Rivet looks like:"]}],"\n",["$","div",null,{"className":"max-w-4xl mx-auto mx-auto py-6","children":["$","div",null,{"className":"not-prose relative bg-white/5 rounded-xl overflow-hidden border border-white/10 overflow-hidden","children":[["$","div",null,{"className":"relative flex justify-center border-b border-white/5","children":["$","$L20",null,{"src":{"src":"/_next/static/media/rivet-guard-arch.a0a2b7ee.svg","height":500,"width":1343,"blurWidth":0,"blurHeight":0},"alt":"Rivet Guard and FoundationDB architecture"}]}],["$","div",null,{"className":"relative rounded-xl overflow-auto flex justify-center text-sm text-slate-400 px-4 py-4","children":["$","p",null,{"children":"New Rivet Guard Architecture"}]}]]}]}],"\n",["$","$L21",null,{"level":3,"id":"configuring-rivet-guard","children":"Configuring Rivet Guard"}],"\n",["$","p",null,{"children":"Configuring Rivet Guard is done by defining three functions:"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","code",null,{"dangerouslySetInnerHTML":{"__html":"routing_fn"}}],": For a given hostname and path, return the target endpoints to route to"]}],"\n",["$","li",null,{"children":[["$","code",null,{"dangerouslySetInnerHTML":{"__html":"middleware_fn"}}],": For a given endpoint, return the middleware (i.e. rate limiting, max in-flight, retries, timeout)"]}],"\n",["$","li",null,{"children":[["$","code",null,{"dangerouslySetInnerHTML":{"__html":"cert_resolver_fn"}}],": For a given hostname, return the TLS certificate to use"]}],"\n"]}],"\n",["$","div",null,{"className":"max-w-2xl mx-auto mx-auto py-6","children":["$","div",null,{"className":"not-prose relative bg-white/5 rounded-xl overflow-hidden border border-white/10 overflow-hidden","children":[["$","div",null,{"className":"relative flex justify-center border-b border-white/5","children":["$","$L20",null,{"src":{"src":"/_next/static/media/rivet-guard-stack.d9641c98.svg","height":454,"width":836,"blurWidth":0,"blurHeight":0},"alt":"Rivet Guard stack"}]}],["$","div",null,{"className":"relative rounded-xl overflow-auto flex justify-center text-sm text-slate-400 px-4 py-4","children":["$","p",null,{"children":"Configuring Rivet Guard"}]}]]}]}],"\n",["$","p",null,{"children":"Configuring Rivet Guard looks like this:"}],"\n",["$","div",null,{"className":"not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none","data-code-group":true,"children":[["$","div",null,{"className":"text-foreground flex items-center justify-between gap-2 border-b p-2 text-xs","children":[["$","div",null,{"className":"text-muted-foreground flex items-center gap-1","children":["$","div",null,{"ref":"$undefined","className":"inline-flex items-center tracking-normal rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-nowrap max-w-full overflow-hidden truncate text-foreground","children":"main.rs"}]}],["$","$L23",null,{"trigger":["$","$L24",null,{"children":["$","button",null,{"className":"group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&_svg]:size-3 gap-1.5","ref":"$undefined","disabled":"$undefined","children":[null,["$","svg",null,{"aria-hidden":"true","focusable":"false","data-prefix":"fas","data-icon":"copy","className":"svg-inline--fa fa-copy ","role":"img","xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 448 512","style":{},"ref":"$undefined","children":["$","path",null,{"fill":"currentColor","d":"M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z","style":{}}]}],null]}]}],"content":"Copy code"}]]}],["$","div",null,{"className":"bg-background text-wrap p-2 text-sm","children":["$","$L25",null,{"className":"w-full","children":["$","span",null,{"className":"not-prose code","dangerouslySetInnerHTML":{"__html":"$27"}}]}]}]]}],"\n",["$","$L22",null,{"title":"Example of Rivet's real routing function","children":[["$","p",null,{"children":"In practice, Rivet's actual routing function looks like this:"}],["$","div",null,{"className":"not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none","data-code-group":true,"children":[["$","div",null,{"className":"text-foreground flex items-center justify-between gap-2 border-b p-2 text-xs","children":[["$","div",null,{"className":"text-muted-foreground flex items-center gap-1","children":["$","div",null,{"ref":"$undefined","className":"inline-flex items-center tracking-normal rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-nowrap max-w-full overflow-hidden truncate text-foreground","children":"routing.rs"}]}],["$","$L23",null,{"trigger":["$","$L24",null,{"children":["$","button",null,{"className":"group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&_svg]:size-3 gap-1.5","ref":"$undefined","disabled":"$undefined","children":[null,["$","svg",null,{"aria-hidden":"true","focusable":"false","data-prefix":"fas","data-icon":"copy","className":"svg-inline--fa fa-copy ","role":"img","xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 448 512","style":{},"ref":"$undefined","children":["$","path",null,{"fill":"currentColor","d":"M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z","style":{}}]}],null]}]}],"content":"Copy code"}]]}],["$","div",null,{"className":"bg-background text-wrap p-2 text-sm","children":["$","$L25",null,{"className":"w-full","children":["$","span",null,{"className":"not-prose code","dangerouslySetInnerHTML":{"__html":"$28"}}]}]}]]}]]}],"\n",["$","$L21",null,{"level":3,"id":"request-lifecycle","children":"Request lifecycle"}],"\n",["$","p",null,{"children":"Rivet Guard is responsible for handling everything from the TCP connection to the actual proxying. Accepting a request handles the following steps:"}],"\n",["$","ol",null,{"children":["\n",["$","li",null,{"children":[["$","strong",null,{"children":"Accept TCP connection"}],": Incoming TCP connection accepted on configured port"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"TLS Handshake"}],": TLS handshake using the cert from ",["$","code",null,{"dangerouslySetInnerHTML":{"__html":"cert_resolver_fn"}}]]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"HTTP Request Parsing"}],": Request parsed by ",["$","code",null,{"dangerouslySetInnerHTML":{"__html":"hyper"}}]]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"Route Resolution"}],": Check route cache or call ",["$","code",null,{"dangerouslySetInnerHTML":{"__html":"routing_fn"}}]]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"Middleware Resolution"}],": Check cache or call ",["$","code",null,{"dangerouslySetInnerHTML":{"__html":"middleware_fn"}}]]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"Rate & in-flight limiting"}],": Apply rate limits using middleware config"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"Request Proxying"}],": Transform and forward request to the target service with retry logic from middleware config (more on this later)","\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["Requires extra logic for forwarding WebSockets powered by ",["$","code",null,{"dangerouslySetInnerHTML":{"__html":"tokio-tungstenite"}}]]}],"\n"]}],"\n"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"Response Handling"}],": Receive and forward response from target service to the client"]}],"\n"]}],"\n",["$","p",null,{"children":["Most of this is pretty standard across reverse proxies, ",["$","strong",null,{"children":"except for steps 4 and 7"}],". We'll dive into how these work in practice."]}],"\n",["$","$L21",null,{"level":2,"id":"achieving-2-000x-faster-route-propagation","children":"Achieving 2,000x Faster Route Propagation"}],"\n",["$","p",null,{"children":"Now for the good part: how does rewriting this critical piece of software make it so much faster?"}],"\n",["$","p",null,{"children":["Instead of waiting 2 seconds for Traefik to poll our configuration, ",["$","strong",null,{"children":["we can immediately look up where to route a request with ",["$","code",null,{"dangerouslySetInnerHTML":{"__html":"routing_fn"}}]]}],"  even if the route isn't ready to serve requests yet (more on that later)."]}],"\n",["$","p",null,{"children":["Under the hood, almost everything in Rivet is powered by FoundationDB. Route lookups are a single key get operation, which takes between 0.1-1 ms. That means that ",["$","strong",null,{"children":"our worst-case routing latency is 1 millisecond"}],"  which is 2,000x faster than our previous 2 second latency."]}],"\n",["$","p",null,{"children":"After the first request to a route, all following requests are cached, meaning that the 1 millisecond overhead is a one-off scenario & future requests take a negligible amount of time to resolve. More on this later."}],"\n",["$","$L21",null,{"level":2,"id":"speeding-up-cold-starts-and-cheating-the-speed-of-light","children":"Speeding Up Cold Starts & Cheating the Speed of Light"}],"\n",["$","p",null,{"children":["Most infrastructure like Kubernetes ",["$","strong",null,{"children":"takes a long time to start containers because you have to wait for many steps"}]," (download image, start container, wait for server ready, wait for health check)."]}],"\n",["$","p",null,{"children":["This means that whenever you need to start a resource, you usually need to wait a ",["$","em",null,{"children":"long"}]," time for it to come up before you have a URL you can access it from."]}],"\n",["$","p",null,{"children":["On the other hand, Rivet returns a URL to access a resource ",["$","em",null,{"children":"before"}]," the resource is ready. This way, ",["$","strong",null,{"children":"the resource has time to start up while the connection URL is being sent back to the client over WAN"}]," (which is bottlenecked by the speed of light) and while the caller's backend processes the request."]}],"\n",["$","div",null,{"className":"max-w-3xl mx-auto mx-auto py-6","children":["$","div",null,{"className":"not-prose relative bg-white/5 rounded-xl overflow-hidden border border-white/10 overflow-hidden","children":[["$","div",null,{"className":"relative flex justify-center border-b border-white/5","children":["$","$L20",null,{"src":{"src":"/_next/static/media/cold-starts.75cad13b.svg","height":752,"width":1707,"blurWidth":0,"blurHeight":0},"alt":"Diagram of cold start events with and without Rivet Guard"}]}],["$","div",null,{"className":"relative rounded-xl overflow-auto flex justify-center text-sm text-slate-400 px-4 py-4","children":["$","p",null,{"children":"Create Container Sequence"}]}]]}]}],"\n",["$","p",null,{"children":"This means that instead of waiting for:"}],"\n",["$","ol",null,{"children":["\n",["$","li",null,{"children":"Container Request"}],"\n",["$","li",null,{"children":"Container Starting"}],"\n",["$","li",null,{"children":"Route Propagating"}],"\n",["$","li",null,{"children":"Your Backend"}],"\n",["$","li",null,{"children":"Send URL To Client"}],"\n",["$","li",null,{"children":"Client Connects To URL"}],"\n"]}],"\n",["$","p",null,{"children":"Rivet Guard can do:"}],"\n",["$","ol",null,{"children":["\n",["$","li",null,{"children":"Container Request"}],"\n",["$","li",null,{"children":["In Parallel:","\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["Rivet Infrastructure","\n",["$","ol",null,{"children":["\n",["$","li",null,{"children":"Container Starting"}],"\n"]}],"\n"]}],"\n",["$","li",null,{"children":["Your Infrastructure","\n",["$","ol",null,{"children":["\n",["$","li",null,{"children":"Your Backend"}],"\n",["$","li",null,{"children":"Send URL To Client"}],"\n",["$","li",null,{"children":"Client Connects To URL"}],"\n"]}],"\n"]}],"\n"]}],"\n"]}],"\n"]}],"\n",["$","div",null,{"className":"relative w-full rounded-xl border p-4 my-4 flex gap-3 bg-gray-950/20 border-gray-700/50","children":[["$","div",null,{"className":"flex-shrink-0 pt-0.5","children":["$","svg",null,{"aria-hidden":"true","focusable":"false","data-prefix":"fas","data-icon":"circle-info","className":"svg-inline--fa fa-circle-info w-5 h-5 text-gray-400","role":"img","xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 512 512","style":{},"ref":"$undefined","children":["$","path",null,{"fill":"currentColor","d":"M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM216 336l24 0 0-64-24 0c-13.3 0-24-10.7-24-24s10.7-24 24-24l48 0c13.3 0 24 10.7 24 24l0 88 8 0c13.3 0 24 10.7 24 24s-10.7 24-24 24l-80 0c-13.3 0-24-10.7-24-24s10.7-24 24-24zm40-208a32 32 0 1 1 0 64 32 32 0 1 1 0-64z","style":{}}]}]}],["$","div",null,{"className":"flex-1 prose-invert prose max-w-full w-full text-gray-100","children":[["$","p",null,{"children":["$","strong",null,{"children":"What if I don't send URL to the client over WAN?"}]}],["$","p",null,{"children":"This sequence assumes that a container URL has to be sent back to the client over WAN,  which adds a full round trip. This is a common pattern for container workloads like game servers, desktop automation, and code sandboxes. Even if you don't need to share the URL to a container publicly, this still significantly cuts latency given that your backend needs time to process the response in parallel with the container starting."}]]}]]}],"\n",["$","$L21",null,{"level":3,"id":"request-buffering","children":"Request Buffering"}],"\n",["$","p",null,{"children":["However, if the resource is not ready by the time the client makes the request, ",["$","strong",null,{"children":["normally a reverse proxy would fail with something like a ",["$","em",null,{"children":"Bad Gateway"}]," error"]}],"."]}],"\n",["$","p",null,{"children":"Instead, Rivet Guard is able to intelligently buffer requests until the resource is ready then delivers the requests."}],"\n",["$","p",null,{"children":["This has the added benefit of ",["$","strong",null,{"children":"gracefully handling resource crashes & restarts"}],". Say a resource becomes unresponsive or restarts: this mechanism can intelligently buffer and send requests once the service accepts the underlying TCP connection. This is incredibly important for Rivet Actors and Rivet Containers where  unlike traditional edge functions  there are frequently singletons (only one instance of a single resource) which need to be able to be gracefully restarted."]}],"\n",["$","p",null,{"children":["This pattern is ",["$","strong",null,{"children":"well proven in systems like FoundationDB"}]," where instead of doing rolling deploys for upgrades, you simply restart the database with the new version. The clients are able to intelligently replay requests so there is no impact to the client. ",["$","$La",null,{"href":"https://github.com/apple/foundationdb/wiki/Upgrading-FoundationDB#upgrade-process","children":"Read more about FoundationDB's upgrade process"}]," to see prior art to this pattern."]}],"\n",["$","$L21",null,{"level":2,"id":"caching-routes","children":"Caching Routes"}],"\n",["$","p",null,{"children":"The key part of this architecture is that the routing function is called lazily and cached for speedy responses."}],"\n",["$","p",null,{"children":["The caching is done by returning the host & path prefix from the routing function. For example, if the user requests ",["$","code",null,{"dangerouslySetInnerHTML":{"__html":"example.com/foo/bar"}}],", but we know that the route prefix is ",["$","code",null,{"dangerouslySetInnerHTML":{"__html":"/foo"}}],", we'll cache that route for all future requests to ",["$","code",null,{"dangerouslySetInnerHTML":{"__html":"example.com/foo/*"}}]," (e.g. including ",["$","code",null,{"dangerouslySetInnerHTML":{"__html":"example.com/foo/baz"}}],")."]}],"\n",["$","p",null,{"children":"The value that gets cached is the targets & the middleware (in separate caches with different timeouts)."}],"\n",["$","$L21",null,{"level":3,"id":"cache-invalidation-of-targets","children":"Cache Invalidation of Targets"}],"\n",["$","p",null,{"children":"If we cache routes and the target changes (e.g. resource upgrades or migrates to a different machine), how do we know when we need to update the target list?"}],"\n",["$","p",null,{"children":["We could implement a cache invalidation system by sending a message to all Rivet Guard instances (similar to what we did for Traefik with NATS), but this requires adding another moving part to a system that we're trying to keep as simple as possible. ",["$","em",null,{"children":"(We'll still implement this later to minimize p99 when restarting resources & pick up new targets faster.)"}]]}],"\n",["$","p",null,{"children":"Instead, we can implement a much simpler alternative: if we can't route to a target, invalidate the cache and try again:"}],"\n",["$","ol",null,{"children":["\n",["$","li",null,{"children":"Make request to target 1.2.3.4:5678"}],"\n",["$","li",null,{"children":"1.2.3.4:5678 returns connection refused"}],"\n",["$","li",null,{"children":"Invalidate cache & call routing function again"}],"\n",["$","li",null,{"children":"Proceed as usual"}],"\n"]}],"\n",["$","p",null,{"children":"A keen eye may notice  what if Container B gets scheduled on 1.2.3.4:5678 before our cache can be invalidated with a connection refused to Container A? Wouldn't that incorrectly route requests meant for Container A to Container B incorrectly? Yep  that's why we reserve the port after it's been released for a duration longer than our cache expiration, so this never happens."}],"\n",["$","$L21",null,{"level":2,"id":"why-rust-and-not-go","children":"Why Rust, and Not Go?"}],"\n",["$","p",null,{"children":"Now for the fun part  provoking the age-old Crustaceans-Gophers Wars."}],"\n",["$","p",null,{"children":"I want to be clear that this is not your usual \"Rewrite It In Rust\" post  I firmly believe Go would have been a great choice for this as well."}],"\n",["$","p",null,{"children":"Either would have been well suited for the job, but these are some factors that made us comfortable choosing Rust instead of Go, despite Go's extensive history with Traefik, Istio, and other networking infrastructure tools:"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","strong",null,{"children":"Extensive internal ecosystem at Rivet"}],": Everything we have is written in Rust, so we could use all of the monitoring & database tooling we've already battle tested"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"Building around Hyper & Tungstenite"}],": Hyper is powering many production systems. As a startup, we don't have time to futz with building \"correct\" lower-level networking implementations. We also want to support QUIC & upcoming transports, which Hyper provides for free."]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"Memory safety"}],": The surface area of bugs we need to worry about with Rust is much smaller than Go  which I can't overstate the importance of for something as critical as our gateway that touches every request that reaches Rivet"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"Correctness guarantees"}],": The surface area of bugs we need to worry about with Rust is much smaller than Go because of features like ",["$","code",null,{"dangerouslySetInnerHTML":{"__html":"Option"}}]," preventing null pointer panics, sum types making invalid states unrepresentable, and concrete error types forcing explicit error handling. I can't overstate the importance of for something as critical as our gateway that touches every request that reaches Rivet."]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"No GC pauses"}],": Go advertises sub-millisecond GC pauses, but I'm not an expert enough in Go to understand the tradeoffs here. The real experience is always different than the advertised  and Rust has fewer moving parts that make it much easier to conceptualize where any potential performance issues might be coming from."]}],"\n"]}],"\n",["$","$L21",null,{"level":2,"id":"alternatives-considered","children":"Alternatives Considered"}],"\n",["$","p",null,{"children":"Our use case is not totally unique. Most large companies need complicated dynamic route discovery, so there are mature tools in the ecosystem for this."}],"\n",["$","$L21",null,{"level":3,"id":"envoy","children":"Envoy"}],"\n",["$","p",null,{"children":["Envoy is used heavily in services like Consul for dynamic configuration. ",["$","$La",null,{"href":"https://www.envoyproxy.io/","children":"Envoy"}]," works via using a \"discovery service\" (xDS) as described in their ",["$","$La",null,{"href":"https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/operations/dynamic_configuration","children":"dynamic configuration documentation"}],"."]}],"\n",["$","p",null,{"children":"We could've exposed a customized Endpoint Discovery Service (EDS) and Route Discovery Service (RDS) over gRPC or REST to support this."}],"\n",["$","p",null,{"children":"Why we went with our own custom solution:"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"Our logic for optimistic retries, caching, and cache invalidation is incredibly specialized to our architecture"}],"\n",["$","li",null,{"children":"We can easily add more features deeply integrated with the gateway, such as analytics, etc"}],"\n",["$","li",null,{"children":"Gateways are always on the bleeding edge of networking standards  if we want to support WebTransport or other new technologies, we don't want to have fork Envoy"}],"\n",["$","li",null,{"children":["We have use cases that include TCP & UDP that's not included in this piece. This is not Envoy's strong suite  we'd likely have to also incorporate ",["$","$La",null,{"href":"https://github.com/googleforgames/quilkin","children":"Quilkin"}]," to make UDP work"]}],"\n",["$","li",null,{"children":"Less moving parts: this is a single binary with fewer points of failure (no need for a gRPC or REST server)"}],"\n",["$","li",null,{"children":["We care a lot about portability & being able to run all of Rivet in a single container for a full local dev environment (",["$","$La",null,{"href":"https://rivet.gg/docs/cloud/self-hosting/single-container","children":"single container docs"}],")"]}],"\n",["$","li",null,{"children":"Faster & easier to write it from scratch than parse Envoy's obscure documentation; past experiences with Envoy require reading the source to understand how to configure it"}],"\n"]}],"\n",["$","$L21",null,{"level":3,"id":"cloudflare-pingora","children":"Cloudflare Pingora"}],"\n",["$","p",null,{"children":[["$","code",null,{"dangerouslySetInnerHTML":{"__html":"rivet-guard-core"}}]," has a lot of similarities to ",["$","$La",null,{"href":"https://blog.cloudflare.com/pingora-open-source/","children":"Cloudflare's Pingora project"}]," which supports programmable network services."]}],"\n",["$","p",null,{"children":["Pingora likely would've met our use case with flying colors. It came down to: the MVP for what we need is not that large. ",["$","code",null,{"dangerouslySetInnerHTML":{"__html":"rivet-guard-core"}}]," is only 1,777 physical lines of code (excluding tests) and ",["$","code",null,{"dangerouslySetInnerHTML":{"__html":"rivet-guard"}}]," (which implements routing logic) is only 861 physical lines of code."]}],"\n",["$","p",null,{"children":"Similar to our reason for not using Envoy, we have a lot of edge cases in what our gateway needs to do, so it was a safer bet in time investment (both for MVP and our future projects) to build it from scratch rather than run into a wall with an external library and have to fork + try to get merged."}],"\n",["$","p",null,{"children":"Despite Rivet Guard's source being relatively small, I don't want to understate the difficulty of writing a reverse proxy. Reverse proxies are easy to implement, but even easier to implement incorrectly. Most of the time developing Rivet Guard was spent writing test cases to handle edge cases around TLS, WebSockets, retries, caching, common DoS attacks, etc."}],"\n",["$","$L21",null,{"level":2,"id":"looking-forward","children":"Looking Forward"}],"\n",["$","p",null,{"children":"There are many features that we're looking forward to being able to support having a solid foundation with Rivet Guard."}],"\n",["$","$L21",null,{"level":3,"id":"rivet-platform-features","children":"Rivet Platform Features"}],"\n",["$","p",null,{"children":"These are features that we hope to implement in the future that influenced our design:"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","strong",null,{"children":"Rivet Container & Rivet Actor wake on network request"}],": We can dynamically wake containers when a network request comes to them to make workloads cheaper"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"WebSocket & SSE hibernation for Rivet Actors & Rivet Containers"}],": A neat feature that Cloudflare has on Durable Objects, having a fully custom gateway allows us to maintain WebSocket connections open on the gateway while letting our actors sleep and re-wake on a WebSocket message"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"Request-based autoscaling for Rivet Containers & Rivet Functions"}]," CPU/memory metric based autoscaling (think HPA/VPA) is notoriously slow to respond to requests and can lead to outages if traffic spikes too fast or minimums are not set correctly. You can autoscale much more efficiently and avoid dropping requests with request-based autoscaling that factors the load balancer into the equation. This allows for fewer wasted resources and no outages on spiky traffic."]}],"\n",["$","li",null,{"children":["$","strong",null,{"children":"Analytics on traffic going to your application"}]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"Anycast"}],": Roll out our own anycast network with Rivet Guard as the entrypoint"]}],"\n"]}],"\n",["$","$L21",null,{"level":3,"id":"quic-http-3-and-web-transport","children":"QUIC, HTTP/3, and WebTransport"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","strong",null,{"children":"QUIC"}]," We don't support QUIC yet  mainly because we haven't taken the time to figure out what sorts of DoS attacks we need to handle with an entirely new transport  but it will be coming soon."]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"WebTransport"}],": ",["$","$La",null,{"href":"https://developer.mozilla.org/en-US/docs/Web/API/WebTransport","children":"WebTransport"}]," is coming... eventually (",["$","$La",null,{"href":"https://caniuse.com/webtransport","children":"looking at you Apple"}],"). It will serve as a modern replacement to WebSockets, with support for congestion control, unreliable transport, and much more. This is going to make proxies much trickier, since it includes unreliable transport & relies on QUIC. This is something we'd much rather be able to handle ourselves, since this is fairly bleeding edge and we've found that many load balancers lag behind in proper support for new transports."]}],"\n"]}],"\n",["$","$L21",null,{"level":2,"id":"conclusion","children":"Conclusion"}],"\n",["$","p",null,{"children":"Building Rivet Guard has unlocked a massive amount of performance benefits, flexibility with future features, and removed the biggest bottleneck to scaling Rivet."}],"\n",["$","p",null,{"children":"Key technical improvements include:"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","strong",null,{"children":"2,000x faster route propagation"}],": From 2 seconds to 1 millisecond"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"Infinite scaling"}],": No more 14MB config size limitation"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"Request buffering"}],": Graceful handling of cold starts and service restarts"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"Simplified architecture"}],": From 3 components to a single stateless service"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"Optimized cold starts"}],": Resources can start while clients are connecting"]}],"\n"]}],"\n",["$","p",null,{"children":"Sometimes you just have to build the exact tool you need."}],"\n",["$","$L21",null,{"level":2,"id":"edits","children":"Edits"}],"\n",["$","p",null,{"children":[["$","strong",null,{"children":"Edit (June 4, 2025):"}]," Fix typo of calling Go not \"memory safety\" and replace with \"correctness guarantees\""]}]],["$","$L29",null,{"title":"2,000x faster route propagation by rewriting our Traefik gateway in Rust"}]]}],["$","aside",null,{"className":"order-2 min-w-0 max-w-xs flex-1 lg:order-3","children":["$","$L2a",null,{"tableOfContents":[{"title":"What is Rivet Guard","id":"what-is-rivet-guard","children":[]},{"title":"The Problem with Traefik","id":"the-problem-with-traefik","children":[{"title":"Architecture with Traefik HTTP Provider","id":"architecture-with-traefik-http-provider","children":[]},{"title":"Where Traefik Started Getting Jammed","id":"where-traefik-started-getting-jammed","children":[]}]},{"title":"Redesigning from the Ground Up","id":"redesigning-from-the-ground-up","children":[]},{"title":"Architecture","id":"architecture","children":[{"title":"Lazy routing","id":"lazy-routing","children":[]},{"title":"Configuring Rivet Guard","id":"configuring-rivet-guard","children":[]},{"title":"Request lifecycle","id":"request-lifecycle","children":[]}]},{"title":"Achieving 2,000x Faster Route Propagation","id":"achieving-2-000x-faster-route-propagation","children":[]},{"title":"Speeding Up Cold Starts & Cheating the Speed of Light","id":"speeding-up-cold-starts-and-cheating-the-speed-of-light","children":[{"title":"Request Buffering","id":"request-buffering","children":[]}]},{"title":"Caching Routes","id":"caching-routes","children":[{"title":"Cache Invalidation of Targets","id":"cache-invalidation-of-targets","children":[]}]},{"title":"Why Rust, and Not Go?","id":"why-rust-and-not-go","children":[]},{"title":"Alternatives Considered","id":"alternatives-considered","children":[{"title":"Envoy","id":"envoy","children":[]},{"title":"Cloudflare Pingora","id":"cloudflare-pingora","children":[]}]},{"title":"Looking Forward","id":"looking-forward","children":[{"title":"Rivet Platform Features","id":"rivet-platform-features","children":[]},{"title":"QUIC, HTTP/3, and WebTransport","id":"quic-http-3-and-web-transport","children":[]}]},{"title":"Conclusion","id":"conclusion","children":[]},{"title":"Edits","id":"edits","children":[]}]}]}]]}]]}],["$","$L2b",null,{"className":"mx-auto w-full mb-8 xl:max-w-[1000px]"}]]
17:[["$","meta","0",{"charSet":"utf-8"}],["$","meta","1",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
12:null
1a:{"metadata":[["$","title","0",{"children":"2,000x faster route propagation by rewriting our Traefik gateway in Rust"}],["$","meta","1",{"name":"description","content":"Rivet is an open-source, self-hostable serverless platform that supports Rivet Functions, Rivet Actors (open-source Cloudflare Durable Objects), and Rivet Containers. We've rewritten our Traefik-based gateway in Rust  now named Rivet Guard  to support the hyper-specific needs of building a serverless platform."}],["$","link","2",{"rel":"author","href":"https://x.com/NathanFlurry/"}],["$","meta","3",{"name":"author","content":"Nathan Flurry"}],["$","meta","4",{"property":"og:title","content":"2,000x faster route propagation by rewriting our Traefik gateway in Rust"}],["$","meta","5",{"property":"og:description","content":"Rivet is an open-source, self-hostable serverless platform that supports Rivet Functions, Rivet Actors (open-source Cloudflare Durable Objects), and Rivet Containers. We've rewritten our Traefik-based gateway in Rust  now named Rivet Guard  to support the hyper-specific needs of building a serverless platform."}],["$","meta","6",{"property":"og:image","content":"http://localhost:3000/_next/static/media/image.c02c4de6.png"}],["$","meta","7",{"property":"og:image:width","content":"2048"}],["$","meta","8",{"property":"og:image:height","content":"1024"}],["$","meta","9",{"property":"og:type","content":"article"}],["$","meta","10",{"property":"article:published_time","content":"2025-06-02T00:00:00.000Z"}],["$","meta","11",{"property":"article:author","content":"Nathan Flurry"}],["$","meta","12",{"property":"article:section","content":"Technical"}],["$","meta","13",{"name":"twitter:card","content":"summary_large_image"}],["$","meta","14",{"name":"twitter:site","content":"@rivetgg"}],["$","meta","15",{"name":"twitter:title","content":"2,000x faster route propagation by rewriting our Traefik gateway in Rust"}],["$","meta","16",{"name":"twitter:description","content":"Rivet is an open-source, self-hostable serverless platform that supports Rivet Functions, Rivet Actors (open-source Cloudflare Durable Objects), and Rivet Containers. We've rewritten our Traefik-based gateway in Rust  now named Rivet Guard  to support the hyper-specific needs of building a serverless platform."}],["$","meta","17",{"name":"twitter:image","content":"http://localhost:3000/_next/static/media/image.c02c4de6.png"}],["$","meta","18",{"name":"twitter:image:width","content":"2048"}],["$","meta","19",{"name":"twitter:image:height","content":"1024"}]],"error":null,"digest":"$undefined"}
15:{"metadata":"$1a:metadata","error":null,"digest":"$undefined"}
1f:["$","ul",null,{"className":"text-muted-foreground hidden list-disc pl-5 text-sm lg:block","children":[["$","li","2025-07-01-introducing-rivetkit-backend-libraries-that-replace-saas",{"className":"py-1","children":["$","$La",null,{"href":"/changelog/2025-07-01-introducing-rivetkit-backend-libraries-that-replace-saas","children":"Introducing RivetKit: Backend Libraries That Replace SaaS"}]}],["$","li","2025-06-24-cloudflare-containers-vs-rivet-containers-vs-fly-machines",{"className":"py-1","children":["$","$La",null,{"href":"/blog/2025-06-24-cloudflare-containers-vs-rivet-containers-vs-fly-machines","children":"Container Platform Comparison: Cloudflare Containers vs Rivet Containers vs Fly Machines"}]}],["$","li","2025-06-10-rivet-functions-launch",{"className":"py-1","children":["$","$La",null,{"href":"/changelog/2025-06-10-rivet-functions-launch","children":"Rivet Functions Launch"}]}]]}]
